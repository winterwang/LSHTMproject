% Chapter Template

\chapter{Methods} % Main chapter title

\label{Chapter 2} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}


%-----------------------------------
%	SECTION 1
%-----------------------------------
\section{Dietary diary collected in the NDNS RP}\vspace{-0.3cm}

Participants were asked to keep a record of everything eaten or drunk over four consecutive days. Interviewers undertook three visits with each participant. At the first visit, the interviewer explained the method followed a protocol, taking participants through the sections in the diary including how to describe details of food and drink and portion size and an example day. The second was a brief visit to check for compliance, answer questions or deal with problems and review the diary to identify and edit possible omissions and missing detail. The third visit was to collect the diary and again review and edit possible omissions. 

In the diary, participants were asked to record portion sizes in household measures (e.g. one tablespoon of beans, one Kit Kat finger-size), or for packaged foods to note the weight indicated on the packet. For homemade dishes, participants were asked to record on a separate page in the diary the individual ingredients and quantities for the whole dish along with a brief description of the cooking method and how much of dish they had consumed. In addition to details of what and how much was eaten, participants recorded for each eating occasion; when was it, where they were, who they were eating with. An example, used as guidance for participants, of a food diary for one day is shown in \textbf{Appendix \ref{AppendixC}}.\vspace{-0.3cm}

\subsection{Definition of carbohydrate intake}\vspace{-0.3cm}

Detailed dairy checking was performed to code and convert the food consumption into energy and nutrients intake. Intakes of nutrients were calculated from the food consumption records using a specially adapted Nutrient Databank \parencite{smithers1993maff}, which was originally developed by the Ministry of Agriculture, Fisheries and Food (MAFF) for the Dietary and Nutritional Survey of British Adults. Further details of data
coding and editing are outlined in Appendix A of the NDNS official reports \parencite{NDNSofficial}. Specifically, the main variables that we adopted in the current analysis were defined as: 

\begin{itemize}
	\item Total Energy intake = (protein(gram) $\times$ 17) + (fat(gram) $\times$ 37) + (carbohydrate(gram) $\times$ 16) + (alcohol(gram) $\times$ 29)  kJ;
	\item Carbohydrate intake = total sugars (gram) + starch (gram); 
	\item Total sugars = sum of all individual sugars (gram).
\end{itemize}

To produce a sequence of discrete responses about the carbohydrate intake we are interested, we calculated the energy consumption per hour for each participant. The percentage of energy that contributed by carbohydrate within each hour were calculated for every every participant, each single day. Since we planed to apply latent class analysis (LCA) in the current study, in which the observed indicators for latent classes must be categorical. We then dichotomised the responses according to the carbohydrate contribution to the energy intake at cut-off value of 50\%, i.e. if within an hour if there is any energy intake occured, carbohydrate consumption was categorised into whether it's energy contribution was higher or equal to 50\% of total energy. Consequently, for each day of the recording, there were 24 data points generated by the dairy.

%-----------------------------------
%	SECTION 2
%-----------------------------------
\section{Latent class analysis (LCA)}\vspace{-0.3cm}

Latent class analysis is a statistical technique that identifies categorical latent (unobserved) class variables on the basis of observed categorical variables \parencite{collins2010latent}. It belongs to the family of latent variable models, and is directly analogous to the factor analysis model. The major difference is that the latent variable in LCA is categorical, not continuous as in factor analysis. The basic assumptions in LCA are independent observations, and local independence, as shown in the fundamental expression of a typical LCA model: \vspace{-0.8cm}

\begin{equation}
P(U_{i1} = s_1, U_{i2} = s_2, \cdots, U_{ik} = s_K) = \sum_{t=t}^{T}P(C_i = t)\prod_{k = 1}^{K}P(U_{ik} = s_k | C_i = t)
\label{LCA}
\end{equation}\vspace{-0.7cm}

Where, 

\begin{itemize}
	\item $P(U_{i1} = s_1, U_{i2} = s_2, \cdots, U_{ik} = s_k)$ is the probability of observing a particular vector of responses;
	\item $P(C_i = t)$ is the probability that a randomly selected $i$th observation will be in class $t$;
	\item $P(U_{ik} = s_k | C_i = t)$ is the probability of a particular observed response pattern $U_{ik} = s_k$ conditional on membership in latent class $t$.
\end{itemize}


Equation \ref{LCA} indicates that responses for an observation to the measuring variables are independent of one another given its membership in latent class $t$. However, in the NDNS RP data set, the assumption of independent observations is violated. Each individual completed their dietary diary for four consecutive days, their diary recordings were later converted into 4 sequences of categorical responses reflecting the type of carbohydrate consumption at each hour of the day. The 4 observed sequences (observations) are nested in the participants and therefore are not independent. This nested data structure requires multilevel techniques. 
\vspace{-0.3cm}

%-----------------------------------
%	SUBSECTION 2
%-----------------------------------

\section{Multilevel latent class analysis (MLCA)}\vspace{-0.3cm}


Multilevel latent class analysis accounts for the nested structure of the data by allowing latent class intercepts to vary across level 2 units and thereby examining if and how level 2 units influence the level 1 latent classes. These random intercepts allow the probability of
membership in a particular level 1 (observations) latent class to vary across level 2 units (e.g., here in the current context are the individuals). Essentially this allows the probability that an observation will belong to a
particular level 1 latent class to vary across Level 2 units (individuals). \vspace{-0.5cm}

\subsection{Parametric approach}\vspace{-0.3cm}

Proposed by Vermunt \parencite{Vermunt, vermunt2008latent} and Asparouhov and Muth\'en \parencite{muthen2009multilevel},  a traditional, parametric approach can be applied using a logistic regression model. In an unconditional logistic regression model, the probability of the outcome (i.e. being in latent class $k$) is constant within the 4-day survey for each individual (level 2). Therefore, say when we are fitting a model with $k (k = 1, \cdots, K)$ latent classes in level 1, then in each individual (level 2), there is a probability of being in latent class $k$. A random effect model consider the individual (level 2) to be drawn from a population of adults in the UK, and the probability of the outcome (i.e. being in latent class $k$) across individuals is considered to be a random variable \parencite{snijders2011multilevel}. The 2-level random intercept effect regression model can be expressed as:\vspace{-0.4cm}


\begin{equation}
\begin{aligned}
\text{logit}[P(C_{ij} = t)] & = \beta_{0j} & \textbf{(level 1)}  \\
\beta_{0j} & = \gamma_0 + \gamma_1 w_j + u_{0j} & \textbf{(level 2)} \\ 
\Rightarrow P(C_{ij} = t) & = \frac{\exp{(\gamma_0 + \gamma_1 w_j + u_{0j})}}{1 + \exp{(\gamma_0 + \gamma_1 w_j + u_{0j})}} \\
\end{aligned}
\label{randomLCA}
\end{equation}
\vspace{-0.3cm}

Where we define: 

\begin{itemize}
	\item $P(C_{ij} = t)$ as the probability that the randomly selected $i$th observation of $j$th individual is belonging to latent class $t$;
	\item $u_{0j}$ as the random intercept for $j$th individual; 
	\item the random intercept are assumed be normally distributed (i.e. $u_{0j} \sim N(0, \sigma_{u_0}^2)$), the magnitude of the $u_{0j}$ variance ($\sigma_{u_0}^2$) indicates the influence of the individuals (level 2);
	\item $w_j$ is the predictor for individual (level 2), such as age, and/or sex.
\end{itemize}


Same as in the typical LCA models, the latent class variable in a MLCA is defined by multiple observed indicators (here is defined by the responses of eating carbohydrate within each hour, over 24 hours and during 4 consecutive days of survey period). Considering that the latent class indicators are indicator variables ($U_{ijk}$), the MLCA model can be written as follows:\vspace{-0.8cm}

\begin{equation}
%\begin{aligned}
P(U_{ij1} = s_1, U_{ij2} = s_2, \cdots, U_{ijk} = s_{K}) = \sum_{t=1}^{T}P(C_{ij}=t)\prod_{k=1}^{K}P(U_{ijk} = s_k | C_{ij} = t)
%\end{aligned}
\label{MLCA}
\end{equation}
\vspace{-0.8cm}


Where, 

\begin{itemize}
	\item $ U_{ijk} $ represents the response of eating \textcolor{red}{high/low} carbohydrate on $i$th day of the survey ($i \in (1,2,3,4)$) in subject $j$ (level 2) at the $k$th hour of the day ($k \in (1, 2, 3, \cdots, 24)$);
	\item $C_{ij}$ denotes the latent class membership for subject $j$ on $i$th day of the survey;
	\item A specific latent class is referred to as $t$, and the total number of level 1 latent classes is denoted by $T$;
	\item $P(U_{ijk} = s_k|C_{ij} = t)$ is the probability of a specific response pattern, conditional on membership in latent class $t$.
\end{itemize}


The $P(C_{ij} = t)$ in equation \ref{MLCA} is what we have already defined in equation \ref{randomLCA}.

\vspace{-0.5cm}
\subsection{Non-Parametric approach}\vspace{-0.3cm}


Another approach is using a non-parametric MLCA, in which separate latent class models are specified for level 1 and level 2. Similar with the parametric MLCA approach, there are $T-1$ random intercepts, where $T$ is the number of level 1 latent classes. However, rather than assuming the random intercepts following a normal distribution, the non-parametric MLCA assumes a multinomial (discrete) distribution of the level 2 latent classes. This approach is less computationally demanding compared with the parametric approach. These level 2 latent
classes reflect differences in the probability of belonging to a specific level 1 latent class, so that clusters (i.e., individuals) that contain observations with similar probabilities for the level 1 latent classes will be grouped together. The non-parametric MLCA model can be defined as follows: \vspace{-0.7cm}

\begin{equation}
P(C_{ij} = t | CB_j = m)  = \frac{\exp(\gamma_{tm})}{\sum_{r=1}^{T}\exp(\gamma_{tm})}
\end{equation}

Where, 

\begin{itemize}
	\item $CB_j$ is level 2 latent class membership for $j$th individual;
	\item $\gamma_{tm}$ is level 1 and level 2 indicators. 
\end{itemize}

According to Finch and French's simulation study \parencite{finch2014multilevel}, non-parametric approach generally resulted in more accurate recovery of the underlying latent structure of the data at both levels and provided better latent class model. Specifically, we are interested in exploring meaningful individual (level 2) latent classes rather than their daily consumption classification. Therefore, non-parametric MLCA was employed 1) to identify latent classes of observations (level 1) based on the subjects' responses to the 4-day food and drink diary and 2) to form distinct latent classes of individuals (level 2) based on the distribution of observation-level latent classes within individuals.\vspace{-0.3cm}
 

\section{Strategy}\vspace{-0.3cm}

To identify the best-fitting model, we used the following sequential modelling strategy \parencite{henry2010multilevel}: 

\begin{itemize}
	\item Firstly, we ignored the multilevel structure of the data and estimated a series of traditional LC models to determine the number of classes at the observational-level;
	\item Next, a series of MLCA models were fitted to account for the multi-level structrure of the data. In these models, the number of observational-level classes was based on the best fitting LCA model from the first step, and the LCA model at the individual-level was estimated to identify the number of individual-level latent classes;
	\item Thirdly, when number of individual-level latent classes is defined based on the previous stage, observational-level classes was modified (one class lower and one class higher than in the second step), to see the effect of changing level 1 classes and confirm the best fitting model.
\end{itemize}


%----------------------------------------------------------------------------------------
%	SECTION 2
%----------------------------------------------------------------------------------------

\section{Survey Data}

%-----------------------------------
%	SUBSECTION 1
%-----------------------------------
\subsection{Survey Selection Method}


%-----------------------------------
%	SUBSECTION 2
%-----------------------------------
\subsection{Response rates}
